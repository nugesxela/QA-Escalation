<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA & Escalation Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-active {
            background-color: #3b82f6;
            color: white;
        }
        .tab-inactive {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        .tab-inactive:hover {
            background-color: #e5e7eb;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        .input-field {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 8px 12px;
            width: 100%;
            font-size: 14px;
        }
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #f9fafb;
            color: #374151;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        .btn-secondary:hover {
            background-color: #f3f4f6;
        }
        .progress-bar {
            background-color: #e5e7eb;
            border-radius: 4px;
            height: 8px;
            overflow: hidden;
        }
        .progress-fill {
            background-color: #10b981;
            height: 100%;
            transition: width 0.3s ease;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            padding: 16px;
        }
        .rubric-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 8px;
        }
        .role-badge {
            background: #dbeafe;
            color: #1e40af;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="p-4 max-w-sm mx-auto space-y-4">
        <!-- Login Screen -->
        <div id="login-screen" class="min-h-screen flex items-center justify-center">
            <div class="card p-6 w-full">
                <h1 class="text-xl font-bold text-center mb-6">QA & Escalation Login</h1>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                        <select class="input-field" id="loginRole">
                            <option value="qa_lead">QA Lead (Full Access)</option>
                            <option value="qa_analyst">QA Analyst (Review Only)</option>
                            <option value="manager">Manager (View Only)</option>
                            <option value="agent">Agent (Limited View)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" class="input-field" placeholder="Enter username" id="loginUsername">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" class="input-field" placeholder="Enter password" id="loginPassword">
                    </div>
                    <button class="btn-primary w-full" onclick="login()">Login</button>
                    <div class="text-xs text-gray-500 text-center">
                        Demo: Any username/password works for selected role
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="hidden">
            <!-- Header -->
            <header class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-lg font-bold text-gray-900">QA & Escalation</h1>
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-500" id="user-info">Logged in as QA Lead</span>
                        <span class="role-badge" id="role-badge">QA LEAD</span>
                    </div>
                </div>
                <div class="flex gap-1">
                    <button class="btn-secondary text-xs px-2" onclick="showSettings()" id="settings-btn">⚙️</button>
                    <button class="btn-primary text-xs px-2" onclick="showEscalationForm()" id="escalate-btn">+ Escalate</button>
                    <button class="btn-secondary text-xs px-2" onclick="logout()">Logout</button>
                </div>
            </header>

            <!-- Tab Navigation -->
            <div class="grid grid-cols-3 gap-1 bg-white rounded-lg p-1 shadow-sm border mb-4">
                <button class="tab-button p-2 rounded-md text-center text-xs" data-tab="dashboard" onclick="switchTab('dashboard')">
                    <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    <div>Dashboard</div>
                </button>
                <button class="tab-button p-2 rounded-md text-center text-xs" data-tab="qa" onclick="switchTab('qa')">
                    <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                    <div>QA Review</div>
                </button>
                <button class="tab-button p-2 rounded-md text-center text-xs" data-tab="agents" onclick="switchTab('agents')">
                    <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <div>Agents</div>
                </button>
                <button class="tab-button p-2 rounded-md text-center text-xs" data-tab="escalations" onclick="switchTab('escalations')">
                    <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                    <div>Escalations</div>
                </button>
                <button class="tab-button p-2 rounded-md text-center text-xs" data-tab="integrations" onclick="switchTab('integrations')">
                    <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                    </svg>
                    <div>Integrations</div>
                </button>
                <button class="tab-button p-2 rounded-md text-center text-xs" data-tab="ai" onclick="switchTab('ai')">
                    <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    <div>AI Insights</div>
                </button>
            </div>

            <!-- Tab Content -->
            <div id="tab-content">
                <!-- Dashboard Tab -->
                <div id="dashboard-content" class="tab-content">
                    <div class="metric-card mb-4">
                        <h2 class="text-lg font-bold mb-2">QA Coverage</h2>
                        <div class="text-3xl font-bold mb-1">78%</div>
                        <div class="progress-bar mb-2">
                            <div class="progress-fill" style="width: 78%"></div>
                        </div>
                        <p class="text-sm opacity-90">Target: 85%</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div class="card p-3 text-center">
                            <div class="text-2xl font-bold text-blue-600">342</div>
                            <div class="text-sm text-gray-600">Reviewed Tickets</div>
                        </div>
                        <div class="card p-3 text-center">
                            <div class="text-2xl font-bold text-red-600">19</div>
                            <div class="text-sm text-gray-600">Open Escalations</div>
                        </div>
                    </div>

                    <div class="card p-3">
                        <h3 class="font-semibold mb-2">Recent Activity</h3>
                        <div class="space-y-2 text-sm" id="recent-activity">
                            <div class="flex justify-between">
                                <span>Ticket #1234 reviewed</span>
                                <span class="text-gray-500">2m ago</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Escalation created</span>
                                <span class="text-gray-500">15m ago</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Agent training completed</span>
                                <span class="text-gray-500">1h ago</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- QA Reviews Tab -->
                <div id="qa-content" class="tab-content hidden">
                    <div class="card p-4">
                        <h2 class="text-base font-bold mb-4">QA Review</h2>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Ticket ID</label>
                                <input type="text" class="input-field" placeholder="Enter ticket ID" id="ticketId">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Agent Name</label>
                                <select class="input-field" id="agentName">
                                    <option value="">Select Agent</option>
                                    <option value="Agent A">Agent A</option>
                                    <option value="Agent B">Agent B</option>
                                    <option value="Agent C">Agent C</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Transcript</label>
                                <textarea class="input-field" rows="3" placeholder="Paste conversation transcript here..." id="transcript"></textarea>
                            </div>
                            
                            <!-- Rubric-based Scoring -->
                            <div id="rubric-scoring">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Evaluation Rubric</label>
                                <div id="rubric-items"></div>
                                <div class="mt-2 p-2 bg-blue-50 rounded">
                                    <div class="text-sm font-medium">Total Score: <span id="total-score">0</span>/100</div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Additional Feedback</label>
                                <textarea class="input-field" rows="2" placeholder="Provide additional feedback..." id="feedback"></textarea>
                            </div>
                            <button class="btn-primary w-full" onclick="submitQAReview()">Submit Review</button>
                        </div>
                    </div>
                </div>

                <!-- Agents Tab -->
                <div id="agents-content" class="tab-content hidden">
                    <div class="card p-3">
                        <h2 class="text-base font-bold mb-3">Agent Scores</h2>
                        <ul class="space-y-2" id="agents-list">
                            <li class="flex justify-between text-sm">
                                <span>Agent A</span>
                                <span class="font-medium">92%</span>
                            </li>
                            <li class="flex justify-between text-sm">
                                <span>Agent B</span>
                                <span class="font-medium">81%</span>
                            </li>
                            <li class="flex justify-between text-sm">
                                <span>Agent C</span>
                                <span class="font-medium">76%</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Escalations Tab -->
                <div id="escalations-content" class="tab-content hidden">
                    <div class="card p-3">
                        <h2 class="text-base font-bold mb-3">Escalations</h2>
                        <ul class="space-y-2 text-sm" id="escalations-list">
                            <li class="flex justify-between items-center">
                                <span>Ticket #12345</span>
                                <button class="btn-primary text-xs px-2 py-1" onclick="sendToJira('12345')">Send to Jira</button>
                            </li>
                            <li class="flex justify-between items-center">
                                <span>Ticket #67890</span>
                                <button class="btn-primary text-xs px-2 py-1" onclick="sendToLinear('67890')">Send to Linear</button>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Integrations Tab -->
                <div id="integrations-content" class="tab-content hidden">
                    <div class="space-y-3">
                        <!-- Integration Status -->
                        <div class="card p-3">
                            <h2 class="text-base font-bold mb-3">Integration Status</h2>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-2">
                                        <div class="w-3 h-3 bg-red-500 rounded-full" id="jira-status"></div>
                                        <span class="text-sm">Jira</span>
                                    </div>
                                    <button class="btn-secondary text-xs px-2 py-1" onclick="configureJira()">Configure</button>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-2">
                                        <div class="w-3 h-3 bg-red-500 rounded-full" id="linear-status"></div>
                                        <span class="text-sm">Linear</span>
                                    </div>
                                    <button class="btn-secondary text-xs px-2 py-1" onclick="configureLinear()">Configure</button>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-2">
                                        <div class="w-3 h-3 bg-yellow-500 rounded-full" id="slack-status"></div>
                                        <span class="text-sm">Slack</span>
                                    </div>
                                    <button class="btn-secondary text-xs px-2 py-1" onclick="configureSlack()">Configure</button>
                                </div>
                            </div>
                        </div>

                        <!-- Ticket Tracking -->
                        <div class="card p-3">
                            <h3 class="font-semibold mb-2">Ticket Tracking</h3>
                            <div class="space-y-2 text-sm" id="ticket-tracking">
                                <div class="text-gray-500">Configure integrations to start tracking tickets</div>
                            </div>
                        </div>

                        <!-- Integration Actions -->
                        <div class="card p-3">
                            <h3 class="font-semibold mb-2">Quick Actions</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <button class="btn-primary text-xs py-2" onclick="syncAllTickets()">Sync All Tickets</button>
                                <button class="btn-secondary text-xs py-2" onclick="testConnections()">Test Connections</button>
                                <button class="btn-secondary text-xs py-2" onclick="viewLogs()">View Logs</button>
                                <button class="btn-secondary text-xs py-2" onclick="exportData()">Export Data</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights Tab -->
                <div id="insights-content" class="tab-content hidden">
                    <div class="card p-3">
                        <h2 class="text-base font-bold mb-3">Insights</h2>
                        <div class="space-y-2 text-sm">
                            <p><strong>QA vs CSAT Correlation:</strong> Strong</p>
                            <p><strong>Coaching Impact:</strong> +12% after training</p>
                            <p><strong>Recurring Issues:</strong> Login errors, Payment delays</p>
                        </div>
                    </div>
                </div>

                <!-- AI Tab -->
                <div id="ai-content" class="tab-content hidden">
                    <div class="card p-3">
                        <h2 class="text-base font-bold mb-3">AI Assistance</h2>
                        <div class="space-y-2 text-sm">
                            <p>Auto-suggested QA Scores available</p>
                            <p><strong>Sentiment:</strong> 68% Positive, 20% Neutral, 12% Negative</p>
                            <p><strong>Trend Forecast:</strong> Escalations may rise 15% next week</p>
                            <button class="btn-primary text-xs px-3 py-1 mt-2" onclick="reviewAISuggestions()">Review AI Suggestions</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4" style="z-index: 1000;">
            <div class="bg-white rounded-lg p-4 w-full max-w-sm max-h-96 overflow-y-auto">
                <h3 class="font-bold mb-3">Settings & Rubric Configuration</h3>
                <div class="space-y-4">
                    <div id="rubric-config">
                        <h4 class="font-semibold text-sm mb-2">Evaluation Rubric (QA Lead Only)</h4>
                        <div id="rubric-editor"></div>
                        <button class="btn-secondary text-xs mt-2" onclick="addRubricItem()">+ Add Criteria</button>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn-primary flex-1" onclick="saveSettings()">Save</button>
                        <button class="btn-secondary flex-1" onclick="closeSettings()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Escalation Modal -->
        <div id="escalation-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4" style="z-index: 1000;">
            <div class="bg-white rounded-lg p-4 w-full max-w-sm">
                <h3 class="font-bold mb-3">Create Escalation</h3>
                <div class="space-y-3">
                    <input type="text" class="input-field" placeholder="Ticket ID" id="escalationTicketId">
                    <select class="input-field" id="escalationPriority">
                        <option value="">Select Priority</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                    <textarea class="input-field" rows="3" placeholder="Reason for escalation..." id="escalationReason"></textarea>
                    <div class="flex gap-2">
                        <button class="btn-primary flex-1" onclick="submitEscalation()">Create</button>
                        <button class="btn-secondary flex-1" onclick="closeEscalationForm()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Integration Configuration Modal -->
        <div id="integration-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4" style="z-index: 1000;">
            <div class="bg-white rounded-lg p-4 w-full max-w-sm max-h-96 overflow-y-auto">
                <h3 class="font-bold mb-3" id="integration-title">Configure Integration</h3>
                <div class="space-y-3" id="integration-form">
                    <!-- Dynamic content will be populated here -->
                </div>
                <div class="flex gap-2 mt-4">
                    <button class="btn-primary flex-1" onclick="saveIntegration()">Save</button>
                    <button class="btn-secondary flex-1" onclick="closeIntegrationModal()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Logs Modal -->
        <div id="logs-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4" style="z-index: 1000;">
            <div class="bg-white rounded-lg p-4 w-full max-w-sm max-h-96 overflow-y-auto">
                <h3 class="font-bold mb-3">Integration Logs</h3>
                <div class="space-y-2 text-xs font-mono bg-gray-100 p-2 rounded max-h-64 overflow-y-auto" id="logs-content">
                    <!-- Logs will be populated here -->
                </div>
                <button class="btn-secondary w-full mt-3" onclick="closeLogsModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'dashboard';
        let currentUser = null;
        
        // Role permissions
        const rolePermissions = {
            qa_lead: {
                canReview: true,
                canEscalate: true,
                canViewAll: true,
                canConfigureRubric: true,
                canManageSettings: true
            },
            qa_analyst: {
                canReview: true,
                canEscalate: true,
                canViewAll: true,
                canConfigureRubric: false,
                canManageSettings: false
            },
            manager: {
                canReview: false,
                canEscalate: false,
                canViewAll: true,
                canConfigureRubric: false,
                canManageSettings: false
            },
            agent: {
                canReview: false,
                canEscalate: false,
                canViewAll: false,
                canConfigureRubric: false,
                canManageSettings: false
            }
        };
        
        // Default evaluation rubric
        let evaluationRubric = [
            { criteria: 'Communication Clarity', weight: 25, score: 0 },
            { criteria: 'Problem Resolution', weight: 30, score: 0 },
            { criteria: 'Customer Empathy', weight: 20, score: 0 },
            { criteria: 'Process Adherence', weight: 15, score: 0 },
            { criteria: 'Response Time', weight: 10, score: 0 }
        ];
        
        // Integration configurations
        let integrationConfigs = {
            jira: {
                enabled: false,
                url: 'https://yourcompany.atlassian.net',
                username: '',
                apiToken: '',
                projectKey: 'QA',
                issueType: 'Bug'
            },
            linear: {
                enabled: false,
                apiKey: '',
                teamId: '',
                labelIds: []
            },
            slack: {
                enabled: false,
                webhookUrl: '',
                channel: '#qa-alerts'
            }
        };

        let integrationLogs = [];
        let currentIntegrationType = '';

        // Data storage
        let appData = {
            agents: [
                { name: 'Agent A', score: 92, tickets: 23, responseTime: 2.3 },
                { name: 'Agent B', score: 81, tickets: 18, responseTime: 4.1 },
                { name: 'Agent C', score: 76, tickets: 31, responseTime: 1.8 }
            ],
            escalations: [
                { id: '12345', description: 'Customer refund dispute', priority: 'high', status: 'open', createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000), agent: 'Agent B', integrationStatus: {} },
                { id: '67890', description: 'Technical integration issue', priority: 'medium', status: 'open', createdAt: new Date(Date.now() - 4 * 60 * 60 * 1000), agent: 'Agent A', integrationStatus: {} }
            ],
            qaReviews: [],
            metrics: {
                qaCoverage: 78,
                reviewedTickets: 342,
                openEscalations: 2
            },
            recentActivity: [
                { action: 'Ticket #1234 reviewed', time: new Date(Date.now() - 2 * 60 * 1000) },
                { action: 'Escalation created', time: new Date(Date.now() - 15 * 60 * 1000) },
                { action: 'Agent training completed', time: new Date(Date.now() - 60 * 60 * 1000) }
            ]
        };

        // Authentication
        function login() {
            const role = document.getElementById('loginRole').value;
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }
            
            currentUser = {
                role: role,
                username: username,
                permissions: rolePermissions[role]
            };
            
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            updateUserInterface();
            loadData();
            switchTab('dashboard');
        }
        
        function logout() {
            currentUser = null;
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }
        
        function updateUserInterface() {
            if (!currentUser) return;
            
            const userInfo = document.getElementById('user-info');
            const roleBadge = document.getElementById('role-badge');
            const settingsBtn = document.getElementById('settings-btn');
            const escalateBtn = document.getElementById('escalate-btn');
            
            userInfo.textContent = `${currentUser.username}`;
            roleBadge.textContent = currentUser.role.toUpperCase().replace('_', ' ');
            
            // Show/hide buttons based on permissions
            settingsBtn.style.display = currentUser.permissions.canManageSettings ? 'block' : 'none';
            escalateBtn.style.display = currentUser.permissions.canEscalate ? 'block' : 'none';
            
            // Update tab visibility
            updateTabVisibility();
        }
        
        function updateTabVisibility() {
            const qaTab = document.querySelector('[data-tab="qa"]');
            const escalationsTab = document.querySelector('[data-tab="escalations"]');
            
            if (!currentUser.permissions.canReview) {
                qaTab.style.display = 'none';
            }
            
            if (!currentUser.permissions.canViewAll && currentUser.role === 'agent') {
                escalationsTab.style.display = 'none';
            }
        }

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('qaAppData');
            const savedRubric = localStorage.getItem('evaluationRubric');
            const savedIntegrations = localStorage.getItem('integrationConfigs');
            const savedLogs = localStorage.getItem('integrationLogs');
            
            if (saved) {
                const parsed = JSON.parse(saved);
                parsed.escalations.forEach(esc => {
                    esc.createdAt = new Date(esc.createdAt);
                    if (!esc.integrationStatus) esc.integrationStatus = {};
                });
                parsed.recentActivity.forEach(act => act.time = new Date(act.time));
                appData = parsed;
            }
            
            if (savedRubric) {
                evaluationRubric = JSON.parse(savedRubric);
            }
            
            if (savedIntegrations) {
                integrationConfigs = JSON.parse(savedIntegrations);
            }
            
            if (savedLogs) {
                integrationLogs = JSON.parse(savedLogs);
                integrationLogs.forEach(log => log.timestamp = new Date(log.timestamp));
            }
        }

        function saveData() {
            localStorage.setItem('qaAppData', JSON.stringify(appData));
            localStorage.setItem('evaluationRubric', JSON.stringify(evaluationRubric));
            localStorage.setItem('integrationConfigs', JSON.stringify(integrationConfigs));
            localStorage.setItem('integrationLogs', JSON.stringify(integrationLogs));
        }

        function timeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        function switchTab(tabName) {
            // Check permissions
            if (tabName === 'qa' && !currentUser.permissions.canReview) {
                alert('Access denied: You do not have permission to access QA reviews');
                return;
            }
            
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.add('hidden'));

            document.getElementById(tabName + '-content').classList.remove('hidden');

            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                if (button.dataset.tab === tabName) {
                    button.classList.remove('tab-inactive');
                    button.classList.add('tab-active');
                } else {
                    button.classList.remove('tab-active');
                    button.classList.add('tab-inactive');
                }
            });

            currentTab = tabName;
            
            if (tabName === 'dashboard') updateDashboard();
            if (tabName === 'agents') updateAgents();
            if (tabName === 'escalations') updateEscalations();
            if (tabName === 'qa') updateQAForm();
            if (tabName === 'integrations') updateIntegrations();
        }

        function updateQAForm() {
            const rubricContainer = document.getElementById('rubric-items');
            rubricContainer.innerHTML = '';
            
            evaluationRubric.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'rubric-item';
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm font-medium">${item.criteria}</span>
                        <span class="text-xs text-gray-500">${item.weight}%</span>
                    </div>
                    <input type="range" min="0" max="100" value="${item.score}" 
                           class="w-full" onchange="updateRubricScore(${index}, this.value)">
                    <div class="text-xs text-gray-600 mt-1">Score: ${item.score}/100</div>
                `;
                rubricContainer.appendChild(div);
            });
            
            updateTotalScore();
        }
        
        function updateRubricScore(index, score) {
            evaluationRubric[index].score = parseInt(score);
            updateTotalScore();
            
            // Update the display
            const rubricItems = document.querySelectorAll('.rubric-item');
            const scoreDisplay = rubricItems[index].querySelector('.text-xs.text-gray-600');
            scoreDisplay.textContent = `Score: ${score}/100`;
        }
        
        function updateTotalScore() {
            const totalScore = evaluationRubric.reduce((sum, item) => {
                return sum + (item.score * item.weight / 100);
            }, 0);
            
            document.getElementById('total-score').textContent = Math.round(totalScore);
        }

        function updateDashboard() {
            document.querySelector('.progress-fill').style.width = appData.metrics.qaCoverage + '%';
            document.querySelector('.text-3xl').textContent = appData.metrics.qaCoverage + '%';
            
            const metricCards = document.querySelectorAll('#dashboard-content .card .text-2xl');
            metricCards[0].textContent = appData.metrics.reviewedTickets;
            metricCards[1].textContent = appData.metrics.openEscalations;
            
            const activityContainer = document.getElementById('recent-activity');
            activityContainer.innerHTML = '';
            appData.recentActivity.slice(0, 3).forEach(activity => {
                const div = document.createElement('div');
                div.className = 'flex justify-between';
                div.innerHTML = `
                    <span>${activity.action}</span>
                    <span class="text-gray-500">${timeAgo(activity.time)}</span>
                `;
                activityContainer.appendChild(div);
            });
        }

        function updateAgents() {
            const agentsList = document.getElementById('agents-list');
            agentsList.innerHTML = '';
            appData.agents.forEach(agent => {
                const li = document.createElement('li');
                li.className = 'flex justify-between text-sm';
                li.innerHTML = `
                    <span>${agent.name}</span>
                    <span class="font-medium">${agent.score}%</span>
                `;
                agentsList.appendChild(li);
            });
        }

        function updateEscalations() {
            const escalationsList = document.getElementById('escalations-list');
            escalationsList.innerHTML = '';
            appData.escalations.forEach(escalation => {
                const li = document.createElement('li');
                li.className = 'border-b pb-2 mb-2';
                
                let integrationButtons = '';
                let integrationStatus = '';
                
                // Jira integration
                if (escalation.integrationStatus.jira) {
                    integrationStatus += `<div class="text-xs text-green-600">✓ Jira: ${escalation.integrationStatus.jira.externalId}</div>`;
                } else if (integrationConfigs.jira.enabled) {
                    integrationButtons += `<button class="btn-primary text-xs px-2 py-1 mr-1" onclick="sendToJira('${escalation.id}')">Send to Jira</button>`;
                }
                
                // Linear integration
                if (escalation.integrationStatus.linear) {
                    integrationStatus += `<div class="text-xs text-blue-600">✓ Linear: ${escalation.integrationStatus.linear.externalId}</div>`;
                } else if (integrationConfigs.linear.enabled) {
                    integrationButtons += `<button class="btn-primary text-xs px-2 py-1" onclick="sendToLinear('${escalation.id}')">Send to Linear</button>`;
                }
                
                li.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-medium text-sm">Ticket #${escalation.id}</div>
                            <div class="text-xs text-gray-600">${escalation.description}</div>
                            ${integrationStatus}
                        </div>
                        <div class="flex flex-col gap-1">
                            ${integrationButtons}
                        </div>
                    </div>
                `;
                escalationsList.appendChild(li);
            });
            
            if (appData.escalations.length === 0) {
                escalationsList.innerHTML = '<div class="text-gray-500 text-sm">No escalations found</div>';
            }
        }

        // Settings and Rubric Management
        function showSettings() {
            if (!currentUser.permissions.canManageSettings) {
                alert('Access denied: You do not have permission to access settings');
                return;
            }
            
            updateRubricEditor();
            document.getElementById('settings-modal').classList.remove('hidden');
            document.getElementById('settings-modal').classList.add('flex');
        }
        
        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
            document.getElementById('settings-modal').classList.remove('flex');
        }
        
        function updateRubricEditor() {
            const editor = document.getElementById('rubric-editor');
            editor.innerHTML = '';
            
            evaluationRubric.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'rubric-item mb-2';
                div.innerHTML = `
                    <div class="flex gap-2 items-center">
                        <input type="text" value="${item.criteria}" 
                               class="input-field flex-1 text-xs" 
                               onchange="updateRubricCriteria(${index}, this.value)">
                        <input type="number" value="${item.weight}" min="1" max="100"
                               class="input-field w-16 text-xs" 
                               onchange="updateRubricWeight(${index}, this.value)">
                        <button class="btn-secondary text-xs px-2" onclick="removeRubricItem(${index})">×</button>
                    </div>
                `;
                editor.appendChild(div);
            });
        }
        
        function addRubricItem() {
            evaluationRubric.push({
                criteria: 'New Criteria',
                weight: 10,
                score: 0
            });
            updateRubricEditor();
        }
        
        function removeRubricItem(index) {
            evaluationRubric.splice(index, 1);
            updateRubricEditor();
        }
        
        function updateRubricCriteria(index, value) {
            evaluationRubric[index].criteria = value;
        }
        
        function updateRubricWeight(index, value) {
            evaluationRubric[index].weight = parseInt(value);
        }
        
        function saveSettings() {
            // Normalize weights to 100%
            const totalWeight = evaluationRubric.reduce((sum, item) => sum + item.weight, 0);
            if (totalWeight !== 100) {
                const factor = 100 / totalWeight;
                evaluationRubric.forEach(item => {
                    item.weight = Math.round(item.weight * factor);
                });
            }
            
            saveData();
            alert('Settings saved successfully!');
            closeSettings();
        }

        function showEscalationForm() {
            if (!currentUser.permissions.canEscalate) {
                alert('Access denied: You do not have permission to create escalations');
                return;
            }
            
            document.getElementById('escalation-modal').classList.remove('hidden');
            document.getElementById('escalation-modal').classList.add('flex');
        }

        function closeEscalationForm() {
            document.getElementById('escalation-modal').classList.add('hidden');
            document.getElementById('escalation-modal').classList.remove('flex');
        }

        function submitEscalation() {
            const ticketId = document.getElementById('escalationTicketId').value;
            const priority = document.getElementById('escalationPriority').value;
            const reason = document.getElementById('escalationReason').value;

            if (!ticketId || !priority || !reason) {
                alert('Please fill in all fields');
                return;
            }

            const newEscalation = {
                id: ticketId,
                description: reason,
                priority: priority,
                status: 'open',
                createdAt: new Date(),
                agent: currentUser.username,
                integrationStatus: {}
            };
            
            appData.escalations.unshift(newEscalation);
            appData.metrics.openEscalations++;
            
            appData.recentActivity.unshift({
                action: `Escalation created for Ticket #${ticketId}`,
                time: new Date()
            });
            
            saveData();
            alert(`Escalation created for Ticket #${ticketId} with ${priority} priority`);
            
            document.getElementById('escalationTicketId').value = '';
            document.getElementById('escalationPriority').value = '';
            document.getElementById('escalationReason').value = '';
            
            closeEscalationForm();
            
            if (currentTab === 'dashboard') updateDashboard();
            if (currentTab === 'escalations') updateEscalations();
        }

        function submitQAReview() {
            if (!currentUser.permissions.canReview) {
                alert('Access denied: You do not have permission to submit reviews');
                return;
            }
            
            const ticketId = document.getElementById('ticketId').value;
            const agentName = document.getElementById('agentName').value;
            const transcript = document.getElementById('transcript').value;
            const feedback = document.getElementById('feedback').value;
            const totalScore = Math.round(evaluationRubric.reduce((sum, item) => sum + (item.score * item.weight / 100), 0));

            if (!ticketId || !agentName || !transcript) {
                alert('Please fill in all required fields');
                return;
            }

            const agent = appData.agents.find(a => a.name === agentName);
            if (agent) {
                const currentReviews = appData.qaReviews.filter(r => r.agentName === agent.name).length;
                agent.score = Math.round((agent.score * currentReviews + totalScore) / (currentReviews + 1));
            }

            appData.qaReviews.push({
                ticketId,
                agentName,
                transcript,
                qualityScore: totalScore,
                rubricScores: [...evaluationRubric],
                feedback,
                reviewedAt: new Date(),
                reviewedBy: currentUser.username
            });

            appData.metrics.reviewedTickets++;
            appData.metrics.qaCoverage = Math.min(100, appData.metrics.qaCoverage + 1);
            
            appData.recentActivity.unshift({
                action: `Ticket #${ticketId} reviewed (Score: ${totalScore})`,
                time: new Date()
            });
            
            saveData();
            alert(`QA Review submitted for Ticket #${ticketId} - Score: ${totalScore}/100`);
            
            // Clear form
            document.getElementById('ticketId').value = '';
            document.getElementById('agentName').value = '';
            document.getElementById('transcript').value = '';
            document.getElementById('feedback').value = '';
            evaluationRubric.forEach(item => item.score = 0);
            updateQAForm();
            
            if (currentTab === 'dashboard') updateDashboard();
            if (currentTab === 'agents') updateAgents();
        }

        function sendToJira(ticketId) {
            const escalation = appData.escalations.find(e => e.id === ticketId);
            if (!escalation) return;
            
            if (!integrationConfigs.jira.enabled) {
                alert('Jira integration is not configured. Please configure it in the Integrations tab.');
                return;
            }
            
            // Simulate API call
            const jiraTicketId = `QA-${Math.floor(Math.random() * 1000)}`;
            
            escalation.integrationStatus.jira = {
                status: 'sent',
                externalId: jiraTicketId,
                sentAt: new Date(),
                url: `${integrationConfigs.jira.url}/browse/${jiraTicketId}`
            };
            
            // Add log entry
            addIntegrationLog('jira', `Ticket #${ticketId} sent to Jira as ${jiraTicketId}`, 'success');
            
            appData.recentActivity.unshift({
                action: `Ticket #${ticketId} sent to Jira (${jiraTicketId})`,
                time: new Date()
            });
            
            saveData();
            alert(`Ticket #${ticketId} has been sent to Jira as ${jiraTicketId}`);
            updateEscalations();
            if (currentTab === 'dashboard') updateDashboard();
            if (currentTab === 'integrations') updateIntegrations();
        }

        function sendToLinear(ticketId) {
            const escalation = appData.escalations.find(e => e.id === ticketId);
            if (!escalation) return;
            
            if (!integrationConfigs.linear.enabled) {
                alert('Linear integration is not configured. Please configure it in the Integrations tab.');
                return;
            }
            
            // Simulate API call
            const linearIssueId = `QA-${Math.floor(Math.random() * 1000)}`;
            
            escalation.integrationStatus.linear = {
                status: 'sent',
                externalId: linearIssueId,
                sentAt: new Date(),
                url: `https://linear.app/issue/${linearIssueId}`
            };
            
            // Add log entry
            addIntegrationLog('linear', `Ticket #${ticketId} sent to Linear as ${linearIssueId}`, 'success');
            
            appData.recentActivity.unshift({
                action: `Ticket #${ticketId} sent to Linear (${linearIssueId})`,
                time: new Date()
            });
            
            saveData();
            alert(`Ticket #${ticketId} has been sent to Linear as ${linearIssueId}`);
            updateEscalations();
            if (currentTab === 'dashboard') updateDashboard();
            if (currentTab === 'integrations') updateIntegrations();
        }

        function reviewAISuggestions() {
            const avgScore = Math.round(appData.agents.reduce((sum, agent) => sum + agent.score, 0) / appData.agents.length);
            const lowPerformers = appData.agents.filter(agent => agent.score < avgScore);
            const highEscalations = appData.escalations.filter(esc => esc.priority === 'high').length;
            
            // AI analysis based on rubric data
            const rubricAnalysis = evaluationRubric.map(item => {
                const avgRubricScore = appData.qaReviews.length > 0 ? 
                    appData.qaReviews.reduce((sum, review) => {
                        const rubricItem = review.rubricScores?.find(r => r.criteria === item.criteria);
                        return sum + (rubricItem ? rubricItem.score : 0);
                    }, 0) / appData.qaReviews.length : 0;
                return `${item.criteria}: ${Math.round(avgRubricScore)}% avg`;
            }).join('\n');
            
            let suggestions = 'AI Analysis Results:\n\n';
            suggestions += `• Average agent score: ${avgScore}%\n`;
            suggestions += `• Rubric Performance:\n${rubricAnalysis}\n`;
            
            if (lowPerformers.length > 0) {
                suggestions += `• ${lowPerformers.map(a => a.name).join(', ')} may benefit from additional training\n`;
            }
            
            suggestions += `• ${highEscalations} high-priority escalations need immediate attention\n`;
            suggestions += `• Recommend increasing QA coverage to reach 85% target\n`;
            suggestions += `• Consider implementing automated sentiment analysis for faster issue detection`;
            
            alert(suggestions);
        }

        // Integration Functions
        function updateIntegrations() {
            updateIntegrationStatus();
            updateTicketTracking();
        }
        
        function updateIntegrationStatus() {
            document.getElementById('jira-status').className = `w-3 h-3 rounded-full ${integrationConfigs.jira.enabled ? 'bg-green-500' : 'bg-red-500'}`;
            document.getElementById('linear-status').className = `w-3 h-3 rounded-full ${integrationConfigs.linear.enabled ? 'bg-green-500' : 'bg-red-500'}`;
            document.getElementById('slack-status').className = `w-3 h-3 rounded-full ${integrationConfigs.slack.enabled ? 'bg-green-500' : 'bg-yellow-500'}`;
        }
        
        function updateTicketTracking() {
            const trackingContainer = document.getElementById('ticket-tracking');
            trackingContainer.innerHTML = '';
            
            if (appData.escalations.length === 0) {
                trackingContainer.innerHTML = '<div class="text-gray-500 text-sm">No tickets to track</div>';
                return;
            }
            
            appData.escalations.forEach(escalation => {
                const div = document.createElement('div');
                div.className = 'border-l-4 border-blue-500 pl-2 py-1';
                
                let statusText = `Ticket #${escalation.id} - ${escalation.status}`;
                let integrationInfo = '';
                
                if (escalation.integrationStatus.jira) {
                    integrationInfo += `<br><span class="text-xs text-green-600">✓ Jira: ${escalation.integrationStatus.jira.externalId}</span>`;
                }
                if (escalation.integrationStatus.linear) {
                    integrationInfo += `<br><span class="text-xs text-blue-600">✓ Linear: ${escalation.integrationStatus.linear.externalId}</span>`;
                }
                
                if (!integrationInfo) {
                    integrationInfo = '<br><span class="text-xs text-gray-500">Not sent to any integration</span>';
                }
                
                div.innerHTML = `
                    <div class="text-sm font-medium">${statusText}</div>
                    ${integrationInfo}
                `;
                trackingContainer.appendChild(div);
            });
        }
        
        function configureJira() {
            currentIntegrationType = 'jira';
            showIntegrationModal('Jira Configuration', {
                'Server URL': { type: 'text', value: integrationConfigs.jira.url, key: 'url' },
                'Username': { type: 'text', value: integrationConfigs.jira.username, key: 'username' },
                'API Token': { type: 'password', value: integrationConfigs.jira.apiToken, key: 'apiToken' },
                'Project Key': { type: 'text', value: integrationConfigs.jira.projectKey, key: 'projectKey' },
                'Issue Type': { type: 'text', value: integrationConfigs.jira.issueType, key: 'issueType' }
            });
        }
        
        function configureLinear() {
            currentIntegrationType = 'linear';
            showIntegrationModal('Linear Configuration', {
                'API Key': { type: 'password', value: integrationConfigs.linear.apiKey, key: 'apiKey' },
                'Team ID': { type: 'text', value: integrationConfigs.linear.teamId, key: 'teamId' }
            });
        }
        
        function configureSlack() {
            currentIntegrationType = 'slack';
            showIntegrationModal('Slack Configuration', {
                'Webhook URL': { type: 'text', value: integrationConfigs.slack.webhookUrl, key: 'webhookUrl' },
                'Channel': { type: 'text', value: integrationConfigs.slack.channel, key: 'channel' }
            });
        }
        
        function showIntegrationModal(title, fields) {
            document.getElementById('integration-title').textContent = title;
            const form = document.getElementById('integration-form');
            form.innerHTML = '';
            
            Object.entries(fields).forEach(([label, config]) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                    <input type="${config.type}" class="input-field" value="${config.value}" data-key="${config.key}" placeholder="Enter ${label.toLowerCase()}">
                `;
                form.appendChild(div);
            });
            
            document.getElementById('integration-modal').classList.remove('hidden');
            document.getElementById('integration-modal').classList.add('flex');
        }
        
        function closeIntegrationModal() {
            document.getElementById('integration-modal').classList.add('hidden');
            document.getElementById('integration-modal').classList.remove('flex');
        }
        
        function saveIntegration() {
            const inputs = document.querySelectorAll('#integration-form input');
            inputs.forEach(input => {
                const key = input.dataset.key;
                const value = input.value;
                integrationConfigs[currentIntegrationType][key] = value;
            });
            
            // Enable integration if credentials are provided
            const config = integrationConfigs[currentIntegrationType];
            if (currentIntegrationType === 'jira') {
                config.enabled = config.url && config.username && config.apiToken;
            } else if (currentIntegrationType === 'linear') {
                config.enabled = config.apiKey && config.teamId;
            } else if (currentIntegrationType === 'slack') {
                config.enabled = config.webhookUrl;
            }
            
            addIntegrationLog(currentIntegrationType, `Configuration ${config.enabled ? 'enabled' : 'updated'}`, 'info');
            saveData();
            alert(`${currentIntegrationType.charAt(0).toUpperCase() + currentIntegrationType.slice(1)} configuration saved! ${config.enabled ? 'Integration is now enabled.' : 'Please fill all required fields to enable.'}`);
            closeIntegrationModal();
            
            if (currentTab === 'integrations') updateIntegrations();
        }
        
        function syncAllTickets() {
            let synced = 0;
            appData.escalations.forEach(escalation => {
                if (!escalation.integrationStatus.jira && integrationConfigs.jira.enabled) {
                    // Simulate sync
                    escalation.integrationStatus.jira = {
                        status: 'synced',
                        externalId: `QA-${Math.floor(Math.random() * 1000)}`,
                        sentAt: new Date()
                    };
                    synced++;
                }
                if (!escalation.integrationStatus.linear && integrationConfigs.linear.enabled) {
                    // Simulate sync
                    escalation.integrationStatus.linear = {
                        status: 'synced',
                        externalId: `QA-${Math.floor(Math.random() * 1000)}`,
                        sentAt: new Date()
                    };
                    synced++;
                }
            });
            
            addIntegrationLog('system', `Synced ${synced} tickets across all integrations`, 'success');
            saveData();
            alert(`Synced ${synced} tickets successfully!`);
            if (currentTab === 'integrations') updateIntegrations();
        }
        
        function testConnections() {
            let results = [];
            
            if (integrationConfigs.jira.enabled) {
                results.push('✅ Jira: Connection successful');
                addIntegrationLog('jira', 'Connection test successful', 'success');
            } else {
                results.push('❌ Jira: Not configured');
            }
            
            if (integrationConfigs.linear.enabled) {
                results.push('✅ Linear: Connection successful');
                addIntegrationLog('linear', 'Connection test successful', 'success');
            } else {
                results.push('❌ Linear: Not configured');
            }
            
            if (integrationConfigs.slack.enabled) {
                results.push('✅ Slack: Connection successful');
                addIntegrationLog('slack', 'Connection test successful', 'success');
            } else {
                results.push('⚠️ Slack: Not configured');
            }
            
            alert('Connection Test Results:\n\n' + results.join('\n'));
            saveData();
        }
        
        function viewLogs() {
            const logsContent = document.getElementById('logs-content');
            logsContent.innerHTML = '';
            
            if (integrationLogs.length === 0) {
                logsContent.innerHTML = '<div class="text-gray-500">No logs available</div>';
            } else {
                integrationLogs.slice(-20).reverse().forEach(log => {
                    const div = document.createElement('div');
                    div.className = `text-xs p-1 rounded mb-1 ${log.level === 'error' ? 'bg-red-100' : log.level === 'success' ? 'bg-green-100' : 'bg-blue-100'}`;
                    div.innerHTML = `
                        <span class="font-bold">[${log.service.toUpperCase()}]</span>
                        <span class="text-gray-600">${timeAgo(log.timestamp)}</span><br>
                        ${log.message}
                    `;
                    logsContent.appendChild(div);
                });
            }
            
            document.getElementById('logs-modal').classList.remove('hidden');
            document.getElementById('logs-modal').classList.add('flex');
        }
        
        function closeLogsModal() {
            document.getElementById('logs-modal').classList.add('hidden');
            document.getElementById('logs-modal').classList.remove('flex');
        }
        
        function exportData() {
            const exportData = {
                escalations: appData.escalations,
                qaReviews: appData.qaReviews,
                integrationLogs: integrationLogs,
                integrationConfigs: integrationConfigs,
                exportedAt: new Date()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `qa-dashboard-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            addIntegrationLog('system', 'Data exported successfully', 'info');
            saveData();
        }
        
        function addIntegrationLog(service, message, level = 'info') {
            integrationLogs.push({
                service: service,
                message: message,
                level: level,
                timestamp: new Date()
            });
            
            // Keep only last 100 logs
            if (integrationLogs.length > 100) {
                integrationLogs = integrationLogs.slice(-100);
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Show login screen initially
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        });

        // Close modals when clicking outside
        document.getElementById('escalation-modal').addEventListener('click', function(e) {
            if (e.target === this) closeEscalationForm();
        });
        
        document.getElementById('settings-modal').addEventListener('click', function(e) {
            if (e.target === this) closeSettings();
        });
        
        document.getElementById('integration-modal').addEventListener('click', function(e) {
            if (e.target === this) closeIntegrationModal();
        });
        
        document.getElementById('logs-modal').addEventListener('click', function(e) {
            if (e.target === this) closeLogsModal();
        });

        setInterval(saveData, 30000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97bf93d0b4acc4f0',t:'MTc1NzM0NjM3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
